{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/caasitech/Documents/dehor/maven-project/maven/src/app/api/send-confirmation/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport nodemailer from 'nodemailer';\n\n// Initialize Nodemailer transporter\nconst transporter = nodemailer.createTransport({\n  host: \"smtp.zoho.com\",\n  port: 465,\n  secure: true,\n  auth: {\n    user: process.env.EMAIL_USER || \"support@mavenrnvn.com\",\n    pass: process.env.EMAIL_PASSWORD,\n  },\n  tls: {\n    rejectUnauthorized: false,\n  },\n});\n\n/* ============================\n   Customer Order Confirmation Template\n   (Same as in the checkout route)\n============================ */\nconst createCustomerConfirmationEmail = ({\n  orderNumber,\n  customerName,\n  items,\n  total,\n  paymentMethod\n}: {\n  orderNumber: string;\n  customerName: string;\n  items: Array<{\n    name: string;\n    quantity: number;\n    price: number;\n  }>;\n  total: number;\n  paymentMethod: string;\n}) => {\n  const paymentMethodText = {\n    'bank-transfer': 'Bank Transfer',\n    'btc-wallet': 'BTC Wallet',\n    'gift-card': 'Gift Card'\n  }[paymentMethod] || paymentMethod;\n\n  return `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <style>\n        body { font-family: 'Inter', Arial, sans-serif; line-height: 1.6; color: #333; background: #f9fafb; margin: 0; padding: 0; }\n        .container { max-width: 600px; margin: 0 auto; background: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); }\n        .header { background: #111827; color: #ffffff; padding: 24px; text-align: center; }\n        .header h1 { margin: 0; font-size: 24px; font-weight: 600; }\n        .content { padding: 24px; }\n        .thank-you { font-size: 20px; font-weight: 600; color: #111827; margin-bottom: 16px; }\n        .order-number { background-color: #f0fdf4; color: #065f46; padding: 4px 8px; border-radius: 4px; font-weight: 500; font-size: 14px; display: inline-block; margin-bottom: 16px; }\n        .section { margin-bottom: 24px; }\n        .section-title { font-size: 18px; font-weight: 600; color: #111827; margin-bottom: 12px; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px; }\n        .order-items { width: 100%; border-collapse: collapse; margin-top: 8px; }\n        .order-items th { text-align: left; background-color: #f9fafb; padding: 12px; font-size: 14px; color: #4b5563; border-bottom: 1px solid #e5e7eb; }\n        .order-items td { padding: 16px 12px; border-bottom: 1px solid #e5e7eb; vertical-align: top; }\n        .item-name { font-weight: 500; color: #111827; }\n        .item-quantity, .item-price { color: #4b5563; }\n        .order-totals { margin-top: 24px; text-align: right; }\n        .total-row { display: flex; justify-content: space-between; max-width: 200px; margin-left: auto; padding: 8px 0; }\n        .total-label { color: #4b5563; }\n        .total-value { font-weight: 600; color: #111827; }\n        .grand-total { font-size: 18px; border-top: 2px solid #e5e7eb; margin-top: 8px; padding-top: 12px; }\n        .footer { background-color: #f9fafb; padding: 24px; text-align: center; color: #6b7280; font-size: 14px; line-height: 1.6; }\n        .payment-method { display: inline-block; background-color: #eff6ff; color: #1e40af; padding: 4px 8px; border-radius: 4px; font-size: 14px; margin-top: 8px; }\n        .next-steps { background-color: #f8fafc; border-left: 4px solid #3b82f6; padding: 12px 16px; margin: 16px 0; border-radius: 0 4px 4px 0; }\n        .next-steps-title { font-weight: 600; color: #1e40af; margin-bottom: 8px; }\n        .next-steps-list { margin: 0; padding-left: 20px; }\n        .customer-details { margin-bottom: 24px; }\n        .customer-details p { margin: 4px 0; }\n      </style>\n    </head>\n    <body>\n      <div class=\"container\">\n        <div class=\"header\">\n          <h1>Thank you for your order!</h1>\n        </div>\n\n        <div class=\"content\">\n          <p class=\"thank-you\">Hi ${customerName},</p>\n          <p>We've received your order and it's being processed. You'll receive another email once your items are on their way.</p>\n          \n          <div class=\"order-number\">Order #${orderNumber}</div>\n          \n          <div class=\"customer-details\">\n            <div class=\"section-title\">Order Details</div>\n            <p><strong>Order Number:</strong> ${orderNumber}</p>\n            <p><strong>Order Date:</strong> ${new Date().toLocaleDateString()}</p>\n            <p><strong>Payment Method:</strong> ${paymentMethodText}</p>\n          </div>\n          \n          <div class=\"section\">\n            <div class=\"section-title\">Order Summary</div>\n            <table class=\"order-items\">\n              <thead>\n                <tr>\n                  <th>Product</th>\n                  <th>Quantity</th>\n                  <th>Price</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${items.map(item => `\n                  <tr>\n                    <td class=\"item-name\">${item.name}</td>\n                    <td class=\"item-quantity\">${item.quantity}</td>\n                    <td class=\"item-price\">$${item.price.toFixed(2)}</td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          </div>\n\n          <div class=\"order-totals\">\n            <div class=\"total-row\">\n              <span class=\"total-label\">Subtotal:</span>\n              <span class=\"total-value\">$${total.toFixed(2)}</span>\n            </div>\n            <div class=\"total-row\">\n              <span class=\"total-label\">Shipping:</span>\n              <span class=\"total-value\">$0.00</span>\n            </div>\n            <div class=\"total-row grand-total\">\n              <span class=\"total-label\">Total:</span>\n              <span class=\"total-value\">$${total.toFixed(2)}</span>\n            </div>\n            <div class=\"payment-method\">\n              ${paymentMethodText} Payment\n            </div>\n          </div>\n\n          <div class=\"next-steps\">\n            <div class=\"next-steps-title\">What's Next?</div>\n            <ul class=\"next-steps-list\">\n              <li>We'll process your order within 24 hours</li>\n              <li>You'll receive a shipping confirmation with tracking information</li>\n              <li>For any questions, reply to this email or contact our support</li>\n            </ul>\n          </div>\n        </div>\n\n        <div class=\"footer\">\n          <p>Thank you for shopping with us!</p>\n          <p>If you have any questions about your order, please don't hesitate to contact our customer service team.</p>\n          <p>Â© ${new Date().getFullYear()} Maven. All rights reserved.</p>\n        </div>\n      </div>\n    </body>\n    </html>\n  `;\n};\n\nexport async function POST(request: Request) {\n  try {\n    const { customer, items, total, orderNumber } = await request.json();\n\n    if (!customer || !items?.length || total === undefined || !orderNumber) {\n      return NextResponse.json(\n        { error: \"Invalid request payload\" },\n        { status: 400 }\n      );\n    }\n\n    // Send order confirmation email to customer using Nodemailer\n    const mailOptions = {\n      from: `\"Maven Orders\" <support@mavenrnvn.com>`,\n      to: customer.email,\n      subject: `Your Order #${orderNumber} Confirmation`,\n      html: createCustomerConfirmationEmail({\n        orderNumber,\n        customerName: customer.name,\n        items,\n        total,\n        paymentMethod: customer.paymentMethod || 'bank-transfer',\n      }),\n    };\n\n    const info = await transporter.sendMail(mailOptions);\n    \n    if (!info.accepted || info.accepted.length === 0) {\n      console.error('Email not accepted by SMTP server:', info);\n      return NextResponse.json(\n        { error: 'Failed to send confirmation email', details: info },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json({\n      success: true,\n      message: 'Confirmation email sent successfully',\n      messageId: info.messageId\n    });\n  } catch (error: any) {\n    console.error('Send confirmation error:', error);\n    return NextResponse.json(\n      { error: 'Failed to process confirmation email', details: error.message },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,oCAAoC;AACpC,MAAM,cAAc,4JAAU,CAAC,eAAe,CAAC;IAC7C,MAAM;IACN,MAAM;IACN,QAAQ;IACR,MAAM;QACJ,MAAM,QAAQ,GAAG,CAAC,UAAU,IAAI;QAChC,MAAM,QAAQ,GAAG,CAAC,cAAc;IAClC;IACA,KAAK;QACH,oBAAoB;IACtB;AACF;AAEA;;;6BAG6B,GAC7B,MAAM,kCAAkC,CAAC,EACvC,WAAW,EACX,YAAY,EACZ,KAAK,EACL,KAAK,EACL,aAAa,EAWd;IACC,MAAM,oBAAoB;QACxB,iBAAiB;QACjB,cAAc;QACd,aAAa;IACf,CAAC,CAAC,cAAc,IAAI;IAEpB,OAAO,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;kCAwCwB,EAAE,aAAa;;;2CAGN,EAAE,YAAY;;;;8CAIX,EAAE,YAAY;4CAChB,EAAE,IAAI,OAAO,kBAAkB,GAAG;gDAC9B,EAAE,kBAAkB;;;;;;;;;;;;;;gBAcpD,EAAE,MAAM,GAAG,CAAC,CAAA,OAAQ,CAAC;;0CAEK,EAAE,KAAK,IAAI,CAAC;8CACR,EAAE,KAAK,QAAQ,CAAC;4CAClB,EAAE,KAAK,KAAK,CAAC,OAAO,CAAC,GAAG;;gBAEpD,CAAC,EAAE,IAAI,CAAC,IAAI;;;;;;;;yCAQa,EAAE,MAAM,OAAO,CAAC,GAAG;;;;;;;;yCAQnB,EAAE,MAAM,OAAO,CAAC,GAAG;;;cAG9C,EAAE,kBAAkB;;;;;;;;;;;;;;;;;eAiBnB,EAAE,IAAI,OAAO,WAAW,GAAG;;;;;EAKxC,CAAC;AACH;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,GAAG,MAAM,QAAQ,IAAI;QAElE,IAAI,CAAC,YAAY,CAAC,OAAO,UAAU,UAAU,aAAa,CAAC,aAAa;YACtE,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,6DAA6D;QAC7D,MAAM,cAAc;YAClB,MAAM,CAAC,sCAAsC,CAAC;YAC9C,IAAI,SAAS,KAAK;YAClB,SAAS,CAAC,YAAY,EAAE,YAAY,aAAa,CAAC;YAClD,MAAM,gCAAgC;gBACpC;gBACA,cAAc,SAAS,IAAI;gBAC3B;gBACA;gBACA,eAAe,SAAS,aAAa,IAAI;YAC3C;QACF;QAEA,MAAM,OAAO,MAAM,YAAY,QAAQ,CAAC;QAExC,IAAI,CAAC,KAAK,QAAQ,IAAI,KAAK,QAAQ,CAAC,MAAM,KAAK,GAAG;YAChD,QAAQ,KAAK,CAAC,sCAAsC;YACpD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAAqC,SAAS;YAAK,GAC5D;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT,WAAW,KAAK,SAAS;QAC3B;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAwC,SAAS,MAAM,OAAO;QAAC,GACxE;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}