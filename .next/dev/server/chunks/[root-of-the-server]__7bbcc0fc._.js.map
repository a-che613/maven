{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/caasitech/Documents/dehor/maven-project/maven/src/app/api/checkout/route.ts"],"sourcesContent":["import nodemailer from \"nodemailer\";\nimport { NextResponse } from \"next/server\";\nimport { cookies } from \"next/headers\";\n\n/* ============================\n   Email Transporter (Zoho)\n============================ */\nconst transporter = nodemailer.createTransport({\n  host: \"smtp.zoho.com\",\n  port: 465,\n  secure: true,\n  auth: {\n    user: \"support@mavenrnvn.com\",\n    pass: \"9B466UMUziVU\", // Zoho app password\n  },\n  tls: {\n    rejectUnauthorized: false,\n  },\n});\n\n/* ============================\n   Admin Order Notification Template\n============================ */\nconst createAdminOrderEmail = ({\n  orderNumber,\n  customer,\n  items,\n  total,\n  paymentMethod\n}: {\n  orderNumber: string;\n  customer: {\n    name: string;\n    email: string;\n    phone: string;\n    address: string;\n  };\n  items: Array<{\n    name: string;\n    quantity: number;\n    price: number;\n    image?: string;\n  }>;\n  total: number;\n  paymentMethod: string;\n}) => {\n  const paymentMethodText = {\n    'bank-transfer': 'Bank Transfer',\n    'btc-wallet': 'BTC Wallet',\n    'gift-card': 'Gift Card'\n  }[paymentMethod] || paymentMethod;\n\n  return `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <style>\n        body { font-family: 'Inter', Arial, sans-serif; line-height: 1.6; color: #333; background: #f9fafb; margin: 0; padding: 0; }\n        .container { max-width: 600px; margin: 0 auto; background: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); }\n        .header { background: #111827; color: #ffffff; padding: 24px; text-align: center; }\n        .header h1 { margin: 0; font-size: 24px; font-weight: 600; }\n        .content { padding: 24px; }\n        .section { margin-bottom: 24px; }\n        .section-title { font-size: 18px; font-weight: 600; color: #111827; margin-bottom: 12px; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px; }\n        .customer-info { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; }\n        .info-item { margin-bottom: 8px; }\n        .info-label { font-weight: 500; color: #4b5563; margin-bottom: 4px; }\n        .info-value { color: #111827; }\n        .order-items { width: 100%; border-collapse: collapse; margin-top: 8px; }\n        .order-items th { text-align: left; background-color: #f9fafb; padding: 12px; font-size: 14px; color: #4b5563; border-bottom: 1px solid #e5e7eb; }\n        .order-items td { padding: 16px 12px; border-bottom: 1px solid #e5e7eb; vertical-align: top; }\n        .item-name { font-weight: 500; color: #111827; }\n        .item-quantity, .item-price { color: #4b5563; }\n        .order-totals { margin-top: 24px; text-align: right; }\n        .total-row { display: flex; justify-content: space-between; max-width: 200px; margin-left: auto; padding: 8px 0; }\n        .total-label { color: #4b5563; }\n        .total-value { font-weight: 600; color: #111827; }\n        .grand-total { font-size: 18px; border-top: 2px solid #e5e7eb; margin-top: 8px; padding-top: 12px; }\n        .footer { background-color: #f9fafb; padding: 16px 24px; text-align: center; color: #6b7280; font-size: 14px; }\n        .order-number { background-color: #f0fdf4; color: #065f46; padding: 4px 8px; border-radius: 4px; font-weight: 500; font-size: 14px; display: inline-block; margin-bottom: 16px; }\n        .payment-method { display: inline-block; background-color: #eff6ff; color: #1e40af; padding: 4px 8px; border-radius: 4px; font-size: 14px; margin-top: 8px; }\n      </style>\n    </head>\n    <body>\n      <div class=\"container\">\n        <div class=\"header\">\n          <h1>New Order Received</h1>\n        </div>\n\n        <div class=\"content\">\n          <div class=\"order-number\">Order #${orderNumber}</div>\n          \n          <div class=\"section\">\n            <div class=\"section-title\">Customer Information</div>\n            <div class=\"customer-info\">\n              <div class=\"info-item\">\n                <div class=\"info-label\">Name</div>\n                <div class=\"info-value\">${customer.name}</div>\n              </div>\n              <div class=\"info-item\">\n                <div class=\"info-label\">Email</div>\n                <div class=\"info-value\">${customer.email}</div>\n              </div>\n              <div class=\"info-item\">\n                <div class=\"info-label\">Phone</div>\n                <div class=\"info-value\">${customer.phone}</div>\n              </div>\n              <div class=\"info-item\">\n                <div class=\"info-label\">Payment Method</div>\n                <div class=\"info-value\">${paymentMethodText}</div>\n              </div>\n            </div>\n            <div class=\"info-item\">\n              <div class=\"info-label\">Shipping Address</div>\n              <div class=\"info-value\">${customer.address.replace(/\\n/g, '<br>')}</div>\n            </div>\n          </div>\n\n          <div class=\"section\">\n            <div class=\"section-title\">Order Details</div>\n            <table class=\"order-items\">\n              <thead>\n                <tr>\n                  <th>Product</th>\n                  <th>Quantity</th>\n                  <th>Price</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${items.map(item => `\n                  <tr>\n                    <td class=\"item-name\">${item.name}</td>\n                    <td class=\"item-quantity\">${item.quantity}</td>\n                    <td class=\"item-price\">$${item.price.toFixed(2)}</td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          </div>\n\n          <div class=\"order-totals\">\n            <div class=\"total-row\">\n              <span class=\"total-label\">Subtotal:</span>\n              <span class=\"total-value\">$${total.toFixed(2)}</span>\n            </div>\n            <div class=\"total-row\">\n              <span class=\"total-label\">Shipping:</span>\n              <span class=\"total-value\">$0.00</span>\n            </div>\n            <div class=\"total-row grand-total\">\n              <span class=\"total-label\">Total:</span>\n              <span class=\"total-value\">$${total.toFixed(2)}</span>\n            </div>\n            <div class=\"payment-method\">\n              ${paymentMethodText} Payment\n            </div>\n          </div>\n        </div>\n\n        <div class=\"footer\">\n          <p>This order was placed on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>\n          <p>Please process this order and contact the customer for next steps.</p>\n        </div>\n      </div>\n    </body>\n    </html>\n  `;\n};\n\n/* ============================\n   Customer Order Confirmation Template\n============================ */\nconst createCustomerConfirmationEmail = ({\n  orderNumber,\n  customerName,\n  items,\n  total,\n  paymentMethod\n}: {\n  orderNumber: string;\n  customerName: string;\n  items: Array<{\n    name: string;\n    quantity: number;\n    price: number;\n  }>;\n  total: number;\n  paymentMethod: string;\n}) => {\n  const paymentMethodText = {\n    'bank-transfer': 'Bank Transfer',\n    'btc-wallet': 'BTC Wallet',\n    'gift-card': 'Gift Card'\n  }[paymentMethod] || paymentMethod;\n\n  return `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <style>\n        body { font-family: 'Inter', Arial, sans-serif; line-height: 1.6; color: #333; background: #f9fafb; margin: 0; padding: 0; }\n        .container { max-width: 600px; margin: 0 auto; background: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); }\n        .header { background: #111827; color: #ffffff; padding: 24px; text-align: center; }\n        .header h1 { margin: 0; font-size: 24px; font-weight: 600; }\n        .content { padding: 24px; }\n        .thank-you { font-size: 20px; font-weight: 600; color: #111827; margin-bottom: 16px; }\n        .order-number { background-color: #f0fdf4; color: #065f46; padding: 4px 8px; border-radius: 4px; font-weight: 500; font-size: 14px; display: inline-block; margin-bottom: 16px; }\n        .section { margin-bottom: 24px; }\n        .section-title { font-size: 18px; font-weight: 600; color: #111827; margin-bottom: 12px; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px; }\n        .order-items { width: 100%; border-collapse: collapse; margin-top: 8px; }\n        .order-items th { text-align: left; background-color: #f9fafb; padding: 12px; font-size: 14px; color: #4b5563; border-bottom: 1px solid #e5e7eb; }\n        .order-items td { padding: 16px 12px; border-bottom: 1px solid #e5e7eb; vertical-align: top; }\n        .item-name { font-weight: 500; color: #111827; }\n        .item-quantity, .item-price { color: #4b5563; }\n        .order-totals { margin-top: 24px; text-align: right; }\n        .total-row { display: flex; justify-content: space-between; max-width: 200px; margin-left: auto; padding: 8px 0; }\n        .total-label { color: #4b5563; }\n        .total-value { font-weight: 600; color: #111827; }\n        .grand-total { font-size: 18px; border-top: 2px solid #e5e7eb; margin-top: 8px; padding-top: 12px; }\n        .footer { background-color: #f9fafb; padding: 24px; text-align: center; color: #6b7280; font-size: 14px; line-height: 1.6; }\n        .payment-method { display: inline-block; background-color: #eff6ff; color: #1e40af; padding: 4px 8px; border-radius: 4px; font-size: 14px; margin-top: 8px; }\n        .next-steps { background-color: #f8fafc; border-left: 4px solid #3b82f6; padding: 12px 16px; margin: 16px 0; border-radius: 0 4px 4px 0; }\n        .next-steps-title { font-weight: 600; color: #1e40af; margin-bottom: 8px; }\n        .next-steps-list { margin: 0; padding-left: 20px; }\n      </style>\n    </head>\n    <body>\n      <div class=\"container\">\n        <div class=\"header\">\n          <h1>Thank you for your order!</h1>\n        </div>\n\n        <div class=\"content\">\n          <p class=\"thank-you\">Hi ${customerName},</p>\n          <p>We've received your order and it's being processed. You'll receive another email once your items are on their way.</p>\n          \n          <div class=\"order-number\">Order #${orderNumber}</div>\n          \n          <div class=\"section\">\n            <div class=\"section-title\">Order Summary</div>\n            <table class=\"order-items\">\n              <thead>\n                <tr>\n                  <th>Product</th>\n                  <th>Quantity</th>\n                  <th>Price</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${items.map(item => `\n                  <tr>\n                    <td class=\"item-name\">${item.name}</td>\n                    <td class=\"item-quantity\">${item.quantity}</td>\n                    <td class=\"item-price\">$${item.price.toFixed(2)}</td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          </div>\n\n          <div class=\"order-totals\">\n            <div class=\"total-row\">\n              <span class=\"total-label\">Subtotal:</span>\n              <span class=\"total-value\">$${total.toFixed(2)}</span>\n            </div>\n            <div class=\"total-row\">\n              <span class=\"total-label\">Shipping:</span>\n              <span class=\"total-value\">$0.00</span>\n            </div>\n            <div class=\"total-row grand-total\">\n              <span class=\"total-label\">Total:</span>\n              <span class=\"total-value\">$${total.toFixed(2)}</span>\n            </div>\n            <div class=\"payment-method\">\n              ${paymentMethodText} Payment\n            </div>\n          </div>\n\n          <div class=\"next-steps\">\n            <div class=\"next-steps-title\">What's Next?</div>\n            <ul class=\"next-steps-list\">\n              <li>We'll process your order within 24 hours</li>\n              <li>You'll receive a shipping confirmation with tracking information</li>\n              <li>For any questions, reply to this email or contact our support</li>\n            </ul>\n          </div>\n        </div>\n\n        <div class=\"footer\">\n          <p>Thank you for shopping with us!</p>\n          <p>If you have any questions about your order, please don't hesitate to contact our customer service team.</p>\n          <p>Â© ${new Date().getFullYear()} Maven. All rights reserved.</p>\n        </div>\n      </div>\n    </body>\n    </html>\n  `;\n};\n\n/* ============================\n   POST Handler\n============================ */\nexport async function POST(request: Request) {\n  try {\n    const { customer, items, total } = await request.json();\n\n    if (!customer || !items?.length || total === undefined) {\n      return NextResponse.json(\n        { error: \"Invalid request payload\" },\n        { status: 400 }\n      );\n    }\n\n    // Generate order number (e.g., ORD-123456)\n    const orderNumber = `ORD-${Math.floor(100000 + Math.random() * 900000)}`;\n    const paymentMethod = customer.paymentMethod || 'bank-transfer';\n\n    // 1. Send order notification to admin\n    const adminSubject = `New Order #${orderNumber} - $${total.toFixed(2)}`;\n    const adminHtml = createAdminOrderEmail({\n      orderNumber,\n      customer: {\n        name: customer.name,\n        email: customer.email,\n        phone: customer.phone,\n        address: customer.address,\n      },\n      items,\n      total,\n      paymentMethod,\n    });\n\n    const adminMailOptions = {\n      from: `\"Maven Orders\" <support@mavenrnvn.com>`,\n      to: \"azienwi.che@gmail.com\",\n      bcc: \"support@mavenrnvn.com\",\n      subject: adminSubject,\n      html: adminHtml,\n    };\n\n    // Verify and send admin email\n    await transporter.verify();\n    const adminInfo = await transporter.sendMail(adminMailOptions);\n    \n    if (!adminInfo.accepted || adminInfo.accepted.length === 0) {\n      console.error(\"Admin email not accepted by SMTP server:\", adminInfo);\n      // Don't fail the request, just log the error\n    }\n\n    // 2. Send order confirmation to customer\n    try {\n      const customerMailOptions = {\n        from: '\"Maven Orders\" <support@mavenrnvn.com>',\n        to: customer.email,\n        subject: `Your Order #${orderNumber} Confirmation`,\n        html: createCustomerConfirmationEmail({\n          orderNumber,\n          customerName: customer.name,\n          items,\n          total,\n          paymentMethod,\n        }),\n      };\n      \n      await transporter.sendMail(customerMailOptions);\n    } catch (emailError) {\n      console.error('Failed to send customer confirmation email:', emailError);\n      // Don't fail the request if email sending fails\n    }\n\n    // 3. Clear cart cookie\n    const response = NextResponse.json({ \n      success: true, \n      orderNumber,\n      message: 'Order placed successfully' \n    });\n    \n    // Clear cart cookie\n    response.cookies.set(\"cart\", \"[]\", { path: \"/\" });\n\n    return response;\n  } catch (error: any) {\n    console.error(\"Checkout email error:\", error);\n    return NextResponse.json(\n      { error: \"Failed to process checkout\", details: error.message },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}